<body class="min-h-screen bg-base-100 text-base-content">
  <section class="max-w-5xl mx-auto p-6 space-y-8">
    <!-- T√≠tulo -->
    <div class="text-center">
      <h1 class="text-3xl font-bold">üè¢ Nuevo Contratista - Persona Jur√≠dica</h1>
    </div>

    <form [formGroup]="juridicalPersonForm" (ngSubmit)="onSubmit()" class="space-y-8">
      <!-- DATOS EMPRESA -->
      <div class="card bg-base-200 p-6 space-y-6">
        <h2 class="text-xl font-semibold">üìÑ Datos de la Persona Jur√≠dica</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="label font-bold text-sm">Raz√≥n Social</label>
            <input
              formControlName="businessName"
              type="text"
              class="input input-bordered w-full"
              placeholder="Ej: Constructora ABC S.A.S."
            />
            @if (controlHasError('businessName')) {
            <span class="text-xs text-error">{{ getErrorMessage('businessName', 3) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">NIT</label>
            <input
              formControlName="businessDocumentNumber"
              type="text"
              class="input input-bordered w-full"
              placeholder="Ej: 900123456-7"
              (keypress)="allowOnlyNumbersAndHyphens($event)"
            />
            @if (controlHasError('businessDocumentNumber')) {
            <span class="text-xs text-error">{{ getErrorMessage('businessDocumentNumber', 6) }}</span>
            }
          </div>
        </div>
      </div>

      <!-- DATOS REPRESENTANTE -->
      <div class="card bg-base-200 p-6 space-y-6">
        <h2 class="text-xl font-semibold">üë§ Datos del Representante Legal</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="label font-bold text-sm">Nombre Completo</label>
            <input formControlName="name" type="text" class="input input-bordered w-full" placeholder="Nombre del representante" />
            @if (controlHasError('name')) {
            <span class="text-xs text-error">{{ getErrorMessage('name', 3) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">Tipo de Documento</label>
            <select formControlName="documentType" class="select select-bordered w-full">
              <option value="" disabled selected>Seleccione un tipo</option>
              @for (t of [{value: 'CC', label: 'C√©dula de ciudadan√≠a'}, {value: 'CE', label: 'C√©dula de extranjer√≠a'}, {value: 'PAS',
              label: 'Pasaporte'}]; track t.value) {
              <option [value]="t.value">{{ t.label }}</option>
              }
            </select>
            @if (controlHasError('documentType')) {
            <span class="text-xs text-error">{{ getErrorMessage('documentType') }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">N√∫mero de Documento</label>
            <input
              formControlName="documentNumber"
              type="text"
              class="input input-bordered w-full"
              (keypress)="allowOnlyNumbers($event)"
              placeholder="Ej: 1234567890"
            />
            @if (controlHasError('documentNumber')) {
            <span class="text-xs text-error">{{ getErrorMessage('documentNumber', 6) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">Lugar de Expedici√≥n</label>
            <input
              formControlName="expeditionAddress"
              type="text"
              class="input input-bordered w-full"
              placeholder="Ciudad / Departamento"
            />
            @if (controlHasError('expeditionAddress')) {
            <span class="text-xs text-error">{{ getErrorMessage('expeditionAddress', 3) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">Fecha de Nacimiento</label>
            <input formControlName="birthDate" type="date" class="input input-bordered w-full" />
            @if (controlHasError('birthDate')) {
            <span class="text-xs text-error">{{ getErrorMessage('birthDate') }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">G√©nero</label>
            <select formControlName="genre" class="select select-bordered w-full">
              <option value="" disabled selected>Seleccione</option>
              @for (g of [{value: 'M', label: 'Masculino'}, {value: 'F', label: 'Femenino'}]; track g.value) {
              <option [value]="g.value">{{ g.label }}</option>
              }
            </select>
            @if (controlHasError('genre')) {
            <span class="text-xs text-error">{{ getErrorMessage('genre') }}</span>
            }
          </div>
        </div>
      </div>

      <!-- DATOS DE CONTACTO -->
      <div class="card bg-base-200 p-6 space-y-6">
        <h2 class="text-xl font-semibold">üìû Datos de Contacto</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="label font-bold text-sm">Direcci√≥n</label>
            <input formControlName="address" type="text" class="input input-bordered w-full" placeholder="Ej: Calle 123 #45-67" />
            @if (controlHasError('address')) {
            <span class="text-xs text-error">{{ getErrorMessage('address', 3) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">Tel√©fono 1</label>
            <input
              formControlName="phone"
              type="tel"
              maxlength="10"
              class="input input-bordered w-full"
              (keypress)="allowOnlyNumbers($event)"
            />
            @if (controlHasError('phone')) {
            <span class="text-xs text-error">{{ getErrorMessage('phone', 10) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">Tel√©fono 2</label>
            <input
              formControlName="phone2"
              type="tel"
              maxlength="10"
              class="input input-bordered w-full"
              placeholder="opcional"
              (keypress)="allowOnlyNumbers($event)"
            />
            @if (controlHasError('phone2')) {
            <span class="text-xs text-error">{{ getErrorMessage('phone2', 10) }}</span>
            }
          </div>
          <div>
            <label class="label font-bold text-sm">Correo Electr√≥nico</label>
            <input formControlName="email" type="email" class="input input-bordered w-full" placeholder="correo@ejemplo.com" />
            @if (controlHasError('email')) {
            <span class="text-xs text-error">{{ getErrorMessage('email') }}</span>
            }
          </div>
        </div>
      </div>

      <!-- DATOS BANCARIOS -->
      <div class="card bg-base-200 shadow-md p-6 space-y-6">
        <h2 class="text-xl font-semibold">üè¶ Datos Bancarios</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Entidad -->
          <div class="md:col-span-2">
            <label class="label font-bold text-sm">Entidad Financiera</label>
            <select formControlName="bank" class="select select-bordered w-full" (change)="onBankChange($event)">
              <option value="" disabled selected>Seleccione una entidad</option>
              @for (bank of banks; track bank) {
              <option [value]="bank">{{ bank }}</option>
              }
              <option value="null">Otra entidad financiera</option>
            </select>
            @if (controlHasError('bank')) {
            <span class="text-xs text-error">{{ getErrorMessage('bank') }}</span>
            }
          </div>

          <!-- Otra entidad -->
          @if (juridicalPersonForm.contains('anotherBank')) {
          <div class="md:col-span-2">
            <label class="label font-bold text-sm">Otra entidad</label>
            <input formControlName="anotherBank" type="text" class="input input-bordered w-full" placeholder="Ej: Banco de la Gente" />
            @if (controlHasError('anotherBank')) {
            <span class="text-xs text-error">{{ getErrorMessage('anotherBank', 3) }}</span>
            }
          </div>
          }

          <!-- Tipo cuenta -->
          <div>
            <label class="label font-bold text-sm">Tipo de Cuenta</label>
            <select formControlName="accountType" class="select select-bordered w-full">
              <option value="" disabled selected>Seleccione</option>
              @for (t of [{value: 'AHORROS', label: 'Ahorros'}, {value: 'CORRIENTE', label: 'Corriente'}]; track t.value) {
              <option [value]="t.value">{{ t.label }}</option>
              }
            </select>
            @if (controlHasError('accountType')) {
            <span class="text-xs text-error">{{ getErrorMessage('accountType') }}</span>
            }
          </div>

          <!-- N√∫mero cuenta -->
          <div>
            <label class="label font-bold text-sm">N√∫mero de Cuenta</label>
            <input
              formControlName="bankAccountNumber"
              type="text"
              class="input input-bordered w-full"
              placeholder="123456789"
              (keypress)="allowOnlyNumbers($event)"
            />
            @if (controlHasError('bankAccountNumber')) {
            <span class="text-xs text-error">{{ getErrorMessage('bankAccountNumber') }}</span>
            }
          </div>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex justify-end gap-4">
        <button type="reset" (click)="onReset()" class="btn btn-warning">Reset</button>
        <button type="submit" class="btn btn-success">Guardar</button>
      </div>
    </form>

    <!-- Error Fetch -->
    @if(hasFetchError()) {
    <div class="alert alert-error fixed top-20 right-5 z-50 shadow-lg animate-fade-left animate-duration-700">
      <span>Error: {{ errorMessage() }}</span>
    </div>
    }

    <!-- Modal de √âxito -->
    @if(isFormPosted()) {
    <input type="checkbox" id="success_modal" class="modal-toggle" [checked]="isFormPosted()" />
    <div class="modal">
      <div class="modal-box text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-green-500 mb-4" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
        </svg>
        <h3 class="font-bold text-lg">¬°Registro exitoso!</h3>
        <p class="py-4">La persona jur√≠dica fue creada correctamente.</p>
        <div class="modal-action">
          <label for="success_modal" (click)="closeSuccessModal()" class="btn btn-primary">Cerrar</label>
        </div>
      </div>
    </div>
    }
  </section>
</body>
